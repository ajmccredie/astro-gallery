---
const { title, videoSrc, link } = Astro.props;
---

<div
  class="door-card"
  data-link={link}
>
  <video
    src={videoSrc}
    muted
    playsinline
    preload="metadata"
    class="door-video"
  ></video>
  <div class="door-label">
    {title}
  </div>
</div>

<script client:load>
  // Ensure GSAP loads only once
  if (!window.gsapLoaded) {
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js";
    document.head.appendChild(script);
    window.gsapLoaded = true;
  }

  window.addEventListener("DOMContentLoaded", () => {
    let navigationLocked = false;
    const doors = document.querySelectorAll(".door-card");

    doors.forEach((door) => {
      door.addEventListener("click", async () => {
        if (navigationLocked) return;
        navigationLocked = true;

        const link = door.getAttribute("data-link");
        const video = door.querySelector("video");

        // Play video with speed control
        if (video) {
          video.currentTime = 0;
          video.playbackRate = 3; // adjust speed here
          video.play();
        }

        // Wait for GSAP
        await waitForGSAP();

        // Animate door expanding
        window.gsap.to(door, {
          position: "fixed",
          top: 0,
          left: 0,
          width: "100vw",
          height: "100vh",
          zIndex: 1000,
          duration: 0.8,
          ease: "power3.inOut",
          onComplete: () => {
            setTimeout(() => {
              window.location.href = link; 
            }, 700); // adjust delay as needed
          }
        });
      });
    });
  });

  function waitForGSAP() {
    return new Promise((resolve) => {
      const check = () => (window.gsap ? resolve() : requestAnimationFrame(check));
      check();
    });
  }
</script>

<style>
  .door-card {
    width: 260px;
    height: 420px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    cursor: pointer;
    overflow: hidden;
    background-color: black;
    transition: transform 0.3s ease;
  }
  .door-card:hover {
    transform: scale(1.03);
  }

  .door-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .door-label {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    background: rgba(0,0,0,0.5);
    color: white;
    font-size: 1.5rem;
    padding: 0.75rem;
    font-weight: bold;
  }
</style>
